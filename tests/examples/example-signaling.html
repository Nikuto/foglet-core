<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Foglet-core example</title>
  </head>

  <body>
    Please: Open the console!
  </body>

  <script src='/foglet.bundle.js'></script>
  <script type='text/javascript'>
    console.log(foglet)

    localStorage.debug='foglet-core:*'

    let app1, app2
    app1 = createApp('Foglet1')
    app2 = createApp('Foglet2')
    app1.share()
    app2.share()

    app1.connection().then(() => app2.connection()).then(() => {
      console.log('Peers connected. Play now with them !')
    })



    function createApp(id) {
      const fog = new foglet.Foglet({
        id,
        verbose: true, // want some logs ? switch to false otherwise
        rps: {
          options : {
            webrtc: {
              trickle: true
            },
            signaling: {
              address: 'http://localhost:3000/',
              room: 'test',
              origins: '*'
            }
          }
        }
      })


      fog.onUnicast((id, message) => {
        console.log(`${fog.id} received a unicasted message from ${id}: `, message)
      })
      fog.onBroadcast((id, message) => {
        console.log(`${fog.id} received a broadcasted message from ${id}: `, message)
      })
      return fog
    }

    function testunicast() {
      app1.sendUnicast('Foglet2-I', 'Unicast: Hello world!')
    }

    function testbroadcast() {
      app1.sendBroadcast('Broadcast: Hello world!')
    }
  </script>
</html>
